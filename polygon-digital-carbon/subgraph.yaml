specVersion: 0.0.4
description: Polygon Carbon
repository: https://github.com/KlimaDAO/klima-subgraph
schema:
  file: ./schema.graphql
dataSources:
  - kind: ethereum/contract
    name: ToucanFactory
    network: polygon-amoy
    source:
      address: '0xdDd96D43b0B2Ca179DCefA58e71798d0ce56c9c8'
      abi: ToucanCarbonOffsetsFactory
      startBlock: 7667754
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      file: ./src/templates/ToucanFactory.ts
      entities:
        - ToucanCarbonOffsetsFactory
      abis:
        - name: ToucanCarbonOffsetsFactory
          file: ../lib/abis/ToucanCarbonOffsetsFactory.json
        - name: ToucanCarbonOffsets
          file: ../lib/abis/ToucanCarbonOffsets.json
        - name: ERC20
          file: ../lib/abis/ERC20.json
      eventHandlers:
        - event: TokenCreated(uint256,address)
          handler: handleNewTCO2
  - kind: ethereum/contract
    name: ToucanCarbonOffsetBatch
    network: polygon-amoy
    source:
      address: '0x8A4d7458dDe3023A3B24225D62087701A88b09DD'
      abi: ToucanCarbonOffsetBatches
      startBlock: 7667754
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      file: ./src/ToucanCarbonOffsetBatchHandler.ts
      entities:
        - ToucanCarbonOffsetBatch
      abis:
        - name: ToucanCarbonOffsetBatches
          file: ../lib/abis/ToucanCarbonOffsetBatches.json
      eventHandlers:
        - event: BatchMinted(address,uint256)
          handler: handleBatchMinted
        - event: BatchUpdated(uint256,string,uint256)
          handler: handleBatchUpdated
        - event: Transfer(indexed address,indexed address,indexed uint256)
          handler: handleBatchTransfer
  - kind: ethereum/contract
    name: BCT
    network: polygon-amoy
    source:
      address: '0x8f8b7D5d12c1fC37f20a89Bf4Dfe1E787Da529B5'
      abi: ToucanCarbonPool
      startBlock: 7667754
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      file: ./src/ToucanCarbonPoolHandler.ts
      entities:
        - BCT
      abis:
        - name: ToucanCarbonPool
          file: ../lib/abis/ToucanCarbonPool.json
        - name: ERC20
          file: ../lib/abis/ERC20.json
      eventHandlers:
        - event: Deposited(address,uint256)
          handler: handleDeposited
        - event: Redeemed(address,address,uint256)
          handler: handleRedeemed
        - event: TCO2Bridged(indexed uint32,indexed address,uint256)
          handler: handleToucanTCO2Bridged
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleTransfer
  - kind: ethereum/contract
    name: NCT
    network: polygon-amoy
    source:
      address: '0xD838290e877E0188a4A44700463419ED96c16107'
      abi: ToucanCarbonPool
      startBlock: 7667754
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      file: ./src/ToucanCarbonPoolHandler.ts
      entities:
        - NCT
      abis:
        - name: ToucanCarbonPool
          file: ../lib/abis/ToucanCarbonPool.json
        - name: ERC20
          file: ../lib/abis/ERC20.json
      eventHandlers:
        - event: Deposited(address,uint256)
          handler: handleDeposited
        - event: Redeemed(address,address,uint256)
          handler: handleRedeemed
        - event: TCO2Bridged(indexed uint32,indexed address,uint256)
          handler: handleToucanTCO2Bridged
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleTransfer
  # Toucan cross chain bridges
  - kind: ethereum/contract
    name: ToucanCrossChainMessenger
    network: polygon-amoy
    source:
      address: '0xABaC3D6b281Bbe0Fc0F67b26247cB27994eaAcaf'
      abi: ToucanCrossChainMessenger
      startBlock: 7667754
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      file: ./src/ToucanCrossChainMessengerHandler.ts
      entities:
        - ToucanCrossChainMessenger
      abis:
        - name: ERC20
          file: ../lib/abis/ERC20.json
        - name: ToucanCrossChainMessenger
          file: ../lib/abis/ToucanCrosschainMessenger_Combined.json
      eventHandlers:
        # v1.0.0
        - event: BridgeRequestReceived(indexed uint32,uint32,indexed address,indexed address,uint256,bytes32)
          handler: handleBridgeRequestReceived_1_0_0
        - event: BridgeRequestSent(uint32,indexed uint32,indexed address,indexed address,uint256,uint256,bytes32)
          handler: handleBridgeRequestSent_1_0_0
        # v1.1.0
        - event: BridgeRequestReceived(indexed uint32,uint32,indexed address,address,indexed address,uint256,bytes32)
          handler: handleBridgeRequestReceived_1_1_0
        - event: BridgeRequestSent(uint32,indexed uint32,indexed address,address,indexed address,uint256,uint256,bytes32)
          handler: handleBridgeRequestSent_1_1_0
  - kind: ethereum/contract
    name: ToucanRegenBridge
    network: polygon-amoy
    source:
      address: '0xdC1Dfa22824Af4e423a558bbb6C53a31c3c11DCC'
      abi: ToucanRegenBridge
      startBlock: 7667754
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      file: ./src/ToucanCrossChainMessengerHandler.ts
      entities:
        - ToucanCrossChainMessenger
      abis:
        - name: ERC20
          file: ../lib/abis/ERC20.json
        - name: ToucanRegenBridge
          file: ../lib/abis/ToucanRegenBridge.json
      eventHandlers:
        - event: Bridge(address,string,address,uint256)
          handler: handleToucanRegenBridge
        - event: Issue(string,address,address,uint256,string)
          handler: handleToucanRegenIssue
  - kind: ethereum/contract
    name: MossCarbon
    network: polygon-amoy
    source:
      address: '0xaa7dbd1598251f856c12f63557a4c4397c253cea'
      abi: ERC20
      startBlock: 23193932
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      file: ./src/TransferHandler.ts
      entities:
        - MossCarbon
      abis:
        - name: ERC20
          file: ../lib/abis/ERC20.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleCreditTransfer
  - kind: ethereum/contract
    name: MossCarbonOffset
    network: polygon-amoy
    source:
      address: '0xeDAEFCf60e12Bd331c092341D5b3d8901C1c05A8'
      abi: CarbonChain
      startBlock: 7667754
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      file: ./src/RetirementHandler.ts
      entities:
        - MossCarbonOffset
      abis:
        - name: CarbonChain
          file: ../lib/abis/MossOffsetCarbon.json
      eventHandlers:
        - event: CarbonOffset(uint256,string,string,address,bytes32,indexed uint256,indexed uint256)
          handler: handleMossRetirement
        # - event: CarbonOffsetBatch((uint256,bytes32,uint256,uint256),uint256,bytes32,uint256)
        #   handler: handleMossRetirementToMainnet
  - kind: ethereum/contract
    name: C3ProjectTokenFactory
    network: polygon-amoy
    source:
      address: '0xd0CAE7819FA604ADB8C5c7A2685E6324b9c5417C'
      abi: C3ProjectTokenFactory
      startBlock: 6827036
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      file: ./src/templates/C3ProjectTokenFactory.ts
      entities:
        - C3ProjectTokenFactory
      abis:
        - name: C3ProjectTokenFactory
          file: ../lib/abis/C3ProjectTokenFactory.json
        - name: C3ProjectToken
          file: ../lib/abis/C3ProjectToken.json
        - name: ERC20
          file: ../lib/abis/ERC20.json
      eventHandlers:
        - event: NewTokenProject(string,address)
          handler: handleNewC3T
        - event: StartAsyncToken(address,address,address,uint256,string,string,uint256,uint256)
          handler: handleStartAsyncToken
        - event: EndAsyncToken(address,address,address,uint256,string,string,uint256,uint256,bool,uint256)
          handler: handleEndAsyncToken
  - kind: ethereum/contract
    name: UBO
    network: polygon-amoy
    source:
      address: '0xd9cf88c9993AEf429160c7D725f9aFB4E25e2733'
      abi: C3CarbonPool
      startBlock: 6827291
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      file: ./src/C3CarbonPoolHandler.ts
      entities:
        - UBO
      abis:
        - name: C3CarbonPool
          file: ../lib/abis/C3CarbonPool.json
        - name: ERC20
          file: ../lib/abis/ERC20.json
      eventHandlers:
        - event: Deposited(address,uint256)
          handler: handleDeposited
        - event: Redeemed(address,address,uint256)
          handler: handleRedeemed
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleTransfer
  - kind: ethereum/contract
    name: NBO
    network: polygon-amoy
    source:
      address: '0x71Fb8a17b8DF0D6e3f14F0A955eC7da8140f640A'
      abi: C3CarbonPool
      startBlock: 6827303
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      file: ./src/C3CarbonPoolHandler.ts
      entities:
        - NBO
      abis:
        - name: C3CarbonPool
          file: ../lib/abis/C3CarbonPool.json
        - name: ERC20
          file: ../lib/abis/ERC20.json
      eventHandlers:
        - event: Deposited(address,uint256)
          handler: handleDeposited
        - event: Redeemed(address,address,uint256)
          handler: handleRedeemed
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleTransfer
  - kind: ethereum/contract
    name: C3-Offset
    network: polygon-amoy
    source:
      address: '0x282f92B498744ae357403e0e692646104fCB1dfc'
      abi: C3OffsetNFT
      startBlock: 6827054
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      file: ./src/RetirementHandler.ts
      entities:
        - C3-VCUO
      abis:
        - name: C3OffsetNFT
          file: ../lib/abis/C3OffsetNFT.json
      eventHandlers:
        - event: VCUOMinted(address,uint256)
          handler: handleVCUOMinted
  - kind: ethereum/contract
    name: ICRCarbonContractRegistry
    network: polygon-amoy
    source:
      address: '0x825cccb05d82fcd0381e523116a03b9301e91c61'
      abi: ICRCarbonContractRegistry
      startBlock: 7667754
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      file: ./src/templates/ICRCarbonContractRegistry.ts
      entities:
        - ICRCarbonContractRegistry
      abis:
        - name: ICRCarbonContractRegistry
          file: ../lib/abis/ICRCarbonContractRegistry.json
        - name: ICRProjectToken
          file: ../lib/abis/ICRProjectToken.json
        - name: ERC1155
          file: ../lib/abis/ERC1155.json
      eventHandlers:
        - event: ProjectCreated(indexed uint256,indexed address,string)
          handler: handleNewICC
  # Retirement aggregator
  - kind: ethereum/contract
    name: RetireToucanCarbon
    network: polygon-amoy
    source:
      address: '0xcefb61af5325c0c100cbd77eb4c9f51d17b189ca'
      abi: RetireToucanCarbon
      startBlock: 7667754
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      file: ./src/KlimaAggregator.ts
      entities:
        - KlimaRetire
      abis:
        - name: RetireToucanCarbon
          file: ../lib/abis/RetireToucanCarbon.json
        - name: KlimaCarbonRetirements
          file: ../lib/abis/KlimaCarbonRetirements.json
        - name: ERC20
          file: ../lib/abis/ERC20.json
      eventHandlers:
        - event: ToucanRetired(indexed address,indexed address,string,string,indexed address,address,uint256)
          handler: handleToucanRetired
  - kind: ethereum/contract
    name: RetireMossCarbon
    network: polygon-amoy
    source:
      address: '0xa35f62dbdb93e4B772784E89B7B35736A4aeaCc5'
      abi: RetireMossCarbon
      startBlock: 7667754
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      file: ./src/KlimaAggregator.ts
      entities:
        - KlimaRetire
      abis:
        - name: RetireMossCarbon
          file: ../lib/abis/RetireMossCarbon.json
        - name: KlimaCarbonRetirements
          file: ../lib/abis/KlimaCarbonRetirements.json
        - name: ERC20
          file: ../lib/abis/ERC20.json
      eventHandlers:
        - event: MossRetired(indexed address,indexed address,string,string,indexed address,uint256)
          handler: handleMossRetired
  - kind: ethereum/contract
    name: RetireC3Carbon
    network: polygon-amoy
    source:
      address: '0x53AC0d9F5985551C1f0ca98665d870365D1c6Ead'
      abi: RetireC3Carbon
      startBlock: 7161008
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      file: ./src/KlimaAggregator.ts
      entities:
        - KlimaRetire
      abis:
        - name: RetireC3Carbon
          file: ../lib/abis/RetireC3Carbon.json
        - name: KlimaCarbonRetirements
          file: ../lib/abis/KlimaCarbonRetirements.json
        - name: ERC20
          file: ../lib/abis/ERC20.json
      eventHandlers:
        - event: C3Retired(indexed address,indexed address,string,string,indexed address,address,uint256)
          handler: handleC3Retired
  - kind: ethereum/contract
    name: KlimaInfinity
    network: polygon-amoy
    source:
      address: '0x41e07f12f4E4297B98c2E2e1E93EE2518a07CD54'
      abi: KlimaInfinity
      startBlock: 7161009
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      file: ./src/KlimaAggregator.ts
      entities:
        - KlimaRetire
      abis:
        - name: KlimaInfinity
          file: ../lib/abis/KlimaInfinity.json
        - name: KlimaCarbonRetirements
          file: ../lib/abis/KlimaCarbonRetirements.json
        - name: ERC20
          file: ../lib/abis/ERC20.json
      eventHandlers:
        - event: CarbonRetired(uint8,indexed address,string,indexed address,string,string,indexed address,address,uint256)
          handler: handleCarbonRetired
        - event: CarbonRetired(uint8,indexed address,string,indexed address,string,string,indexed address,address,uint256,uint256)
          handler: handleCarbonRetiredWithTokenId
  # Track KLIMA rebases for creating supply snapshot
  - kind: ethereum/contract
    name: sKlimaERC20V1
    network: polygon-amoy
    source:
      address: '0xb0C22d8D350C67420f06F48936654f567C73E8C8'
      abi: sKlimaERC20V1
      startBlock: 20190686
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - sKlima
      abis:
        - name: sKlimaERC20V1
          file: ../lib/abis/sKlimaERC20V1.json
      eventHandlers:
        - event: LogRebase(indexed uint256,uint256,uint256)
          handler: handleRebase
      file: ./src/sKlimaV1.ts
templates:
  - name: ToucanCarbonOffsets
    kind: ethereum/contract
    network: polygon-amoy
    source:
      abi: ToucanCarbonOffsets
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - ToucanCarbonOffsets
      abis:
        - name: ToucanCarbonOffsets
          file: ../lib/abis/ToucanCarbonOffsets.json
        - name: ERC20
          file: ../lib/abis/ERC20.json
      eventHandlers:
        - event: Retired(address,uint256)
          handler: handleToucanRetired
        - event: Retired(address,uint256,uint256)
          handler: handleToucanRetired_1_4_0
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleCreditTransfer
      file: ./src/TransferHandler.ts
  - name: C3ProjectToken
    kind: ethereum/contract
    network: polygon-amoy
    source:
      abi: C3ProjectToken
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - C3ProjectToken
      abis:
        - name: C3ProjectToken
          file: ../lib/abis/C3ProjectToken.json
        - name: ERC20
          file: ../lib/abis/ERC20.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleCreditTransfer
      file: ./src/TransferHandler.ts
  - name: ICRProjectToken
    kind: ethereum/contract
    network: polygon-amoy
    source:
      abi: ICRProjectToken
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - ICRProjectToken
      abis:
        - name: ICRProjectToken
          file: ../lib/abis/ICRProjectToken.json
        - name: ERC1155
          file: ../lib/abis/ERC1155.json
      eventHandlers:
        - event: TransferSingle(indexed address,indexed address,indexed address,uint256,uint256)
          handler: handle1155CreditTransfer
        - event: TransferBatch(indexed address,indexed address,indexed address,uint256[],uint256[])
          handler: handle1155CreditTransferBatch
        - event: RetiredVintage(indexed address,indexed uint256,uint256,uint256,bytes)
          handler: handleICRRetired
        - event: ExPostCreated(indexed uint256,uint256,uint256,uint256,string)
          handler: handleExPostCreated
        - event: ExAnteMinted(indexed uint256,indexed uint256,indexed address,uint256)
          handler: handleExAnteMinted
      file: ./src/TransferHandler.ts
